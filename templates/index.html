<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="5">
    <title>Kafka Music Streaming Analysis</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-dark text-light">
    <div class="container py-4">
        <h1 class="mb-4">Kafka Music Streaming Analysis Service</h1>

        <!-- Big Data Explanation Block -->
        <div class="mb-4 p-3 bg-secondary rounded">
            <h4 class="text-white">Real-Time Streaming Summary</h4>
            <p>
                This web app shows how real-time data flows through a simplified big data pipeline built with <strong>Apache Kafka</strong>. 
                It simulates music listening activity using randomly generated events — like who’s listening, what they’re listening to, and where they’re listening from.
            </p>
            <ul>
                <li><strong>Topic:</strong> <code>music-streams</code> — the Kafka topic where all events are sent.</li>
                <li><strong>Producer:</strong> Simulates real-time users streaming songs across different genres, platforms, and locations.</li>
                <li><strong>Consumer:</strong> Picks up each message from the topic as it arrives and stores it for live analysis.</li>
                <li><strong>Flask App:</strong> Displays the data on this page and lets users filter by artist, genre, mood, platform, or country.</li>
            </ul>
        </div>

        <!-- Filter Form -->
        <form method="get" class="mb-4 row g-3 align-items-end">
            <div class="col-md-2">
                <label for="artist" class="form-label">Artist</label>
                <input type="text" class="form-control" name="artist" id="artist" placeholder="Joji, Vansire, etc" value="{{ request.args.get('artist', '') }}">
            </div>
            <div class="col-md-2">
                <label for="genre" class="form-label">Genre</label>
                <input type="text" class="form-control" name="genre" id="genre" placeholder="Lo-fi Pop, etc" value="{{ request.args.get('genre', '') }}">
            </div>
            <div class="col-md-2">
                <label for="platform" class="form-label">Platform</label>
                <input type="text" class="form-control" name="platform" id="platform" placeholder="Spotify, etc" value="{{ request.args.get('platform', '') }}">
            </div>
            <div class="col-md-2">
                <label for="country" class="form-label">Country</label>
                <input type="text" class="form-control" name="country" id="country" placeholder="USA, Japan, etc" value="{{ request.args.get('country', '') }}">
            </div>
            <div class="col-md-2">
                <label for="mood" class="form-label">Mood</label>
                <select id="mood" name="mood" class="form-select">
                    <option value="">All Moods</option>
                    {% for m in ['Happy', 'Sad', 'Energetic', 'Calm', 'Romantic', 'Moody', 'Chill', 'Melancholic', 'Hype', 'Dreamy', 'Dark', 'Uplifting', 'Groovy', 'Hopeful', 'Lo-fi'] %}
                    <option value="{{ m }}" {% if request.args.get('mood') == m %}selected{% endif %}>{{ m }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2 d-flex gap-2">
                <button type="submit" class="btn btn-warning w-100">Apply</button>
                <a href="/" class="btn btn-secondary w-100">Clear</a>
            </div>
        </form>


        <!-- Streaming Data Table -->
        <table class="table table-dark table-striped">
            <thead>
                <tr>
                    <th>User</th>
                    <th>Track Title</th>
                    <th>Artist</th>
                    <th>Genre</th>
                    <th>Platform</th>
                    <th>City</th>
                    <th>Country</th>
                    <th>Mood</th>
                </tr>
            </thead>
            <tbody>
                {% for msg in messages %}
                <tr>
                    <td>{{ msg.name }}</td>
                    <td>{{ msg.title }}</td>
                    <td>{{ msg.artist }}</td>
                    <td>{{ msg.genre }}</td>
                    <td>{{ msg.platform }}</td>
                    <td>{{ msg.location.city }}</td>
                    <td>{{ msg.location.country }}</td>
                    <td>{{ msg.mood }}</td>
                </tr>                
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>
